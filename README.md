# 三轴架式机械手控制系统

## 项目概述
本系统是一个基于8051单片机的三轴架式机械手控制系统，主要用于转子精车机、开槽机等工业自动化设备的配套使用。系统通过485通信实现多台机械手的联动控制，并配备迪文串口屏实现人机交互界面。

## 系统架构

### 硬件组成
- 控制器：STC15F2K60S2单片机
- 执行机构：
  - X轴：水平移动机构
  - Y轴：双夹持机构（2个）
- 通信接口：RS485
- 人机界面：迪文串口显示屏
- 限位开关：行程保护

### 功能特点
1. 多轴联动控制
   - X轴水平移动控制
   - 双Y轴夹持装置独立控制
2. 多机械手协同工作
3. 参数可视化配置
4. 实时状态监控

## 电机控制系统

### 电机规格
- 类型：两相步进电机
- 基本参数：
  - 步距角：1.8°/步
  - 细分：10细分（2000步/圈）
  - 行程比：100mm/圈
  - 驱动方式：脉冲+方向

### 硬件连接
#### 1. 控制信号
- PUL（脉冲信号）：连接到P0_1
- DIR（方向信号）：连接到P0_2
- ENA（使能信号）：可选
- GND：信号地

#### 2. 限位位开关
- 右限位（X_R_LIMIT）：常开接点
- 左限位：可选
- COM：公共端

### 运动控制功能

#### 1. 速度规划

```c
// 速度计算公式
steps_per_second = (speed_mm_per_s steps_per_revolution) / (distance_per_revolution_mm/10)
delay_time = 1000000.0 / (steps_per_second 2)
```

#### 2. 运动模式
1. 短距离运动（<200步）
   - 采用梯形加减速
   - 无匀速段
   - 脉冲时间翻倍处理

2. 长距离运动（≥200步）
   - 三段式运动控制：加速-匀速-减速
   - 加速段：100步
   - 匀速段：总步数-2*加速步数
   - 减速段：100步

## 通信协议

### 串口屏通信协议
基于迪文串口屏通信协议实现，主要命令如下：

#### 1. 数据写入命令 (WriteData)
帧格式：
```
0x5A, 0xA5, 0x05, 0x82, 0x00, address, data1, data2
```
- 0x5A 0xA5: 帧头
- 0x05: 数据长度
- 0x82: 写数据命令
- 0x00: 保留字节
- 地址: 变量地址
- 数据1-2: 16位数据的高字节和低字节

#### 2. 页面切换命令 (GoToPage)
帧格式：
```
0x5A, 0xA5, 0x04, 0x80, 0x03, 0x00, page_number
```


#### 3. 数据读取命令 (GetAllData)
帧格式：
```
0x5A, 0xA5, 0x04, 0x83, 0x00, 0x10, 0x20
```
- 0x5A 0xA5: 帧头
- 0x04: 数据长度
- 0x83: 数据读取命令
- 0x00: 保留字节
- 0x10: 起始地址
- 0x20: 数据长度

### 参数地址映射

## 调试方法

### 1. 基础参数调试
1. 速度参数
   - 起始速度：20mm/s（防止丢步）
   - 最高速度：根据负载确定
   - 加速度：通过加速点数调整

2. 运动参数
   - 加速距离：100步（可根据实际调整）
   - 细分数：10细分（可根据精度要求调整）

### 2. 通信调试
1. 串口数据监视
2. LED状态指示
   - P41用于指示通信状态
   - 数据接收时LED闪烁

## 常见问题及解决方案

### 1. 电机控制问题
- 电机不转动
  - 检查脉冲信号
  - 确认驱动器使能状态
  - 验证电源电压
- 运动不准确
  - 检查细分设置
  - 验证步距角参数
  - 确认机械传动比
- 运动不稳定
  - 优化加减速参数
  - 检查电机电流设置
  - 确认机械负载状况

### 2. 通信问题
- 通信中断
  - 检查485连接
  - 验证波特率设置
  - 确认地址配置
- 数据错误
  - 检查校验和
  - 验证数据格式
  - 确认通信时序

## 维护保养
1. 定期检查
   - 电机温度
   - 轴承润滑
   - 皮带张紧度
   - 限位开关功能
   - 通信线路连接

2. 预防性维护
   - 记录运行参数
   - 定期校准原点
   - 备份系统参数

## 注意事项
1. 运动控制
   - 确保在运动前检查限位状态
   - 注意加减速参数的合理设置
   - 避免频繁的急停和方向切换

2. 参数设置
   - 速度设置需考虑电机特性
   - 距离参数需考虑机械限位
   - 加减速参数需根据负载调整

3. 安全事项
   - 定期检查限位开关功能
   - 确保机械零点准确
   - 运动前确认工作区域安全
